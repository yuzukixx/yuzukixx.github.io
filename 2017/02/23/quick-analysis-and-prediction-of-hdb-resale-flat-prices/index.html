<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>Quick analysis and prediction of HDB resale flat prices</title>
  <meta name="description" content="I thought I’d do a quick analysis of HDB resale flat price data, one of the few datasets on data.gov.sg that is raw enough for analysis.">
  <meta name="keywords" content="data, analytics, prediction, hdb resale flats">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://yuzukixx.github.io/2017/02/23/quick-analysis-and-prediction-of-hdb-resale-flat-prices/">
  
  
  <link rel="alternate" type="application/rss+xml" title=".. and maybe some interpolation" href="https://yuzukixx.github.io/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="Quick analysis and prediction of HDB resale flat prices">
  <meta name="twitter:description" content="I thought I’d do a quick analysis of HDB resale flat price data, one of the few datasets on data.gov.sg that is raw enough for analysis.">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  
  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-NNNNNNNN-N', 'auto');
    ga('send', 'pageview');

  </script>


  
    <meta name="google-site-verification" content="7z8fHKNsmBfEIrFFoXpjquX3MACSp1OHBEljyJdWhuM">
  
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">.. and maybe some interpolation</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/">// About</a>
      
        
        <a class="page-link" href="/archives/">// Archives</a>
      
        
        <a class="page-link" href="/contact/">// Contact</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Quick analysis and prediction of HDB resale flat prices</h1>
    
    <p class="post-meta"><time datetime="Feb 23, 2017" itemprop="datePublished">Feb 23, 2017</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">yuzukixx</span></span> • 
  
  
    
  
    
  
    
  
    
      <a href="/categories/r/">r</a>,
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/singapore/">singapore</a>,
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/data/">data</a>,
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/regression/">regression</a>,
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/time-series/">time series</a>
    
  

</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>I thought I’d do a quick analysis of HDB resale flat price data, one of the few datasets on <a href="https://data.gov.sg/">data.gov.sg</a> that is raw enough for analysis. 
<!-- more -->
<br /></p>

<h2>The data</h2>
<p>The dataset I used is the HDB Resale Flat Prices dataset, available <a href="https://data.gov.sg/dataset/resale-flat-prices">here</a>. The data used in this analysis is from March 2012 onwards.</p>

<p>There are 10 variables:</p>

<ul>
  <li>month (of transaction)</li>
  <li>town</li>
  <li>flat type</li>
  <li>flat model</li>
  <li>block</li>
  <li>street name</li>
  <li>storey range</li>
  <li>floor area (in sq metres)</li>
  <li>lease commence date</li>
  <li>resale price</li>
</ul>

<p><br /></p>

<h2>Time series analysis using ARIMA</h2>
<p>The data was first read in as a dataframe called ‘resale’. Then it was aggregated by calculating the mean resale price of flats sold for each month, and plotted.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># plot mean resale flat price
</span><span class="n">monthly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">resale_price</span><span class="o">~</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">resale</span><span class="p">)</span><span class="w">
</span><span class="n">monthly_ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ts</span><span class="p">(</span><span class="n">monthly</span><span class="o">$</span><span class="n">resale_price</span><span class="p">,</span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2012</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">frequency</span><span class="o">=</span><span class="m">12</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">monthly_ts</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Year"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Average Resale Flat Price"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p><img src="../../../../assets/images/23022017_Rplot1.png" alt="Average resale flat prices against time" /></p>

<p>As seen from the above plot, flat prices were generally growing until the slew of cooling measures in 2013 brought the mean resale flat price down. Towards the end, prices seem stable.</p>

<p>For most of the graph, prices were on a downward trend which indicates a non-stationary series. To check, these are the ACF plots with and without differencing. It is clear from the plot on the left that the series is non-stationary (because ACF decreases slowly), and that first differencing quickly fixes this problem.</p>
<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># acf plots
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="n">pty</span><span class="o">=</span><span class="s2">"s"</span><span class="p">)</span><span class="w">
</span><span class="n">acf</span><span class="p">(</span><span class="n">monthly_ts</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Lag (in years)"</span><span class="p">)</span><span class="w">
</span><span class="n">acf</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">monthly_ts</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Lag (in years)"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p><img src="../../../../assets/images/23022017_Rplot2.png" alt="ACF plots with and without differencing" /></p>

<p><br /></p>

<p>Not too sure how variance stabilization would affect this, so I tried ARIMA before and after log transformation of the series. The results were drastically different. AIC, BIC and the various error measures all decreased, so clearly the log transformation helped a lot in making the series stationary on variance.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">require</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span><span class="w">
</span><span class="n">fit1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">auto.arima</span><span class="p">(</span><span class="n">monthly_ts</span><span class="p">,</span><span class="w"> </span><span class="n">approximation</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="n">trace</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w"> </span><span class="c1"># not so good
</span><span class="n">summary</span><span class="p">(</span><span class="n">fit1</span><span class="p">)</span><span class="w">

</span><span class="n">fit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">auto.arima</span><span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="n">monthly_ts</span><span class="p">),</span><span class="w"> </span><span class="n">approximation</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="n">trace</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w"> </span><span class="c1"># much better
</span><span class="n">summary</span><span class="p">(</span><span class="n">fit2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p><img src="../../../../assets/images/23022017_fit1.png" alt="Summary of ARIMA model without log transform" /></p>

<p><img src="../../../../assets/images/23022017_fit2.png" alt="Summary of ARIMA model with log transform" /></p>

<p><br /></p>

<p>Lastly, I used fit2 to plot a prediction (and its 95% confidence intervals) of the mean resale flat prices for the next 10 months. It’s not the most informative, but it’s something.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">prediction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">fit2</span><span class="p">,</span><span class="w"> </span><span class="n">n.ahead</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">monthly_ts</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="s2">"l"</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Average Resale Flat Price"</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2012</span><span class="p">,</span><span class="m">2018</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">400000</span><span class="p">,</span><span class="m">500000</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"ARIMA prediction"</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="m">10</span><span class="o">^</span><span class="p">(</span><span class="n">prediction</span><span class="o">$</span><span class="n">pred</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="m">10</span><span class="o">^</span><span class="p">(</span><span class="n">prediction</span><span class="o">$</span><span class="n">pred</span><span class="m">+2</span><span class="o">*</span><span class="n">prediction</span><span class="o">$</span><span class="n">se</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="m">10</span><span class="o">^</span><span class="p">(</span><span class="n">prediction</span><span class="o">$</span><span class="n">pred</span><span class="m">-2</span><span class="o">*</span><span class="n">prediction</span><span class="o">$</span><span class="n">se</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p><img src="../../../../assets/images/23022017_Rplot3.png" alt="Time series with ARIMA prediction" /></p>

<h2>Regression analysis</h2>
<p>The broad historical analysis above isn’t the most detailed predictor of resale flat price. Previously, in taking just the mean price, we assumed that the proportion of each type/model/age/etc. of flat is roughly the same every month.</p>

<p>However, bigger, newer flats in mature estates tend to command higher prices, and it could skew our analysis if the proportions of these different features vary widely from month to month. Doing a regression analysis with these additional variables would probably give us a more useful prediction.</p>

<p><br /></p>

<p>To avoid overfitting, I decided to go with a straightforward linear regression. However, I still wanted to keep the element of time in there, so I created an additional variable ‘t’. t starts from time 1, which represents March 2012, and increases by 1 each month.</p>

<p>In addition, I wanted to see how well the linear regression worked in predicting flat price, so the original dataset was split into a training and test set. The test set is the last 6 months of the original dataset, from August 2016 to January 2017, and the training set includes everything before.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">model1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">resale_price</span><span class="o">~</span><span class="n">t</span><span class="o">+</span><span class="n">lease_commence_date</span><span class="o">+</span><span class="n">flat_model</span><span class="o">+</span><span class="n">floor_area_sqm</span><span class="o">+</span><span class="n">storey_range</span><span class="o">+</span><span class="n">flat_type</span><span class="o">+</span><span class="n">town</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">training_data</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p>The summary is a bit too long to post here due to the many categorical variables, but the regression turned out well, with an adjusted R-squared value of 0.8577.</p>

<p><br /></p>

<p>While attempting to perform a prediction on the testing data, I found that it had a row with flat_model 2-room, which does not appear anywhere else, including in the training data. It had to be removed as it cannot be accurately predicted.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">#remove rows from testing data that is not accounted for in original model
</span><span class="n">testing_data</span><span class="o">=</span><span class="n">testing_data</span><span class="p">[</span><span class="o">!</span><span class="p">(</span><span class="n">testing_data</span><span class="o">$</span><span class="n">flat_model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"2-room"</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span><span class="w"> </span><span class="n">testing_data</span><span class="p">)</span><span class="w">

</span><span class="c1">#validation
</span><span class="n">residuals</span><span class="o">=</span><span class="n">testing_data</span><span class="o">$</span><span class="n">resale_price</span><span class="o">-</span><span class="n">results</span><span class="w">
</span><span class="n">mse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">residuals</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">rmse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span><span class="w">
</span><span class="n">quantile</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">residuals</span><span class="p">))</span><span class="w">
</span><span class="n">boxplot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="s2">"Residuals from model1"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p><img src="../../../../assets/images/23022017_model1.png" alt="Prediction assessment measures" />
<img src="../../../../assets/images/23022017_Rplot4.png" alt="Boxplot of residuals" /></p>

<p>While the root MSE was about 55 000, the interquartile range for (absolute) residuals was actually between about 14 300 and 54 100. The boxplot shows the reason why, with more outliers above the interquartile range than below. As the mean price we observed earlier was about $450 000, predictions from our model are generally off by 10% or less, which I think is decent for a quick analysis.</p>

<p><br /></p>

<h2>Future analysis</h2>
<p>I previously made use of this dataset in the 2016 Microsoft Data Science Student Challenge, where my team based our predictions on spatial analysis of nearby facilities such as schools and shopping malls. It takes a while to reverse geocode all the addresses, but perhaps I’ll continue this line of analysis in the future.</p>

  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy; yuzukixx. Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a>.

    </p>

  </div>

</footer>


  </body>

</html>
